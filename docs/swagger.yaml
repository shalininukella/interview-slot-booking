openapi: 3.0.3
info:
  title: Interview Slot Booking API
  description: API for managing interview slots, users, and bookings
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: Local server

components:
  securitySchemes:
    xUserIdHeader:
      type: apiKey
      in: header
      name: x-user-id
      description: "Simulate authentication via user ID"

  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Human readable error message"
        errors:
          type: array
          items:
            type: string
          example: ["email is required"]

    User:
      type: object
      properties:
        _id:
          type: string
          example: 63f1b2c1f1f1f1f1f1f1f1f1
        name:
          type: string
          example: John Doe
        email:
          type: string
          example: john@example.com
        role:
          type: string
          enum: [ADMIN, CANDIDATE]
          example: ADMIN
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Slot:
      type: object
      properties:
        _id:
          type: string
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        capacity:
          type: integer
        createdBy:
          $ref: "#/components/schemas/User"
        tags:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        availableSeats:
          type: integer

    Booking:
      type: object
      properties:
        _id:
          type: string
        slotId:
          $ref: "#/components/schemas/Slot"
        candidateId:
          $ref: "#/components/schemas/User"
        status:
          type: string
          enum: [BOOKED, CANCELLED]
        bookedAt:
          type: string
          format: date-time

  parameters:
    PageParam:
      name: page
      in: query
      description: Page number
      required: false
      schema:
        type: integer
        default: 1
    LimitParam:
      name: limit
      in: query
      description: Items per page
      required: false
      schema:
        type: integer
        default: 10

paths:
  /users:
    post:
      tags:
        - Users
      summary: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, role]
              properties:
                name:
                  type: string
                email:
                  type: string
                role:
                  type: string
                  enum: [ADMIN, CANDIDATE]
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email conflict
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    get:
      tags:
        - Users
      summary: List users with optional filters
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [ADMIN, CANDIDATE]
        - name: email
          in: query
          schema:
            type: string
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "400":
          description: Invalid filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /slots:
    post:
      tags:
        - Slots
      summary: Create a slot (ADMIN only)
      parameters:
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [startTime, endTime, capacity]
              properties:
                startTime:
                  type: string
                  format: date-time
                endTime:
                  type: string
                  format: date-time
                capacity:
                  type: integer
                  minimum: 1
                tags:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: Created slot
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Slot"
        "400":
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Overlapping slot
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    get:
      tags:
        - Slots
      summary: List slots with filters
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
        - name: tags
          in: query
          schema:
            type: string
            description: Comma-separated tags
        - name: availableOnly
          in: query
          schema:
            type: boolean
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of slots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Slot"
        "400":
          description: Invalid params
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /slots/{id}:
    get:
      tags:
        - Slots
      summary: Get slot by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Slot details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Slot"
        "400":
          description: Invalid ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    patch:
      tags:
        - Slots
      summary: Update slot (ADMIN only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                startTime:
                  type: string
                  format: date-time
                endTime:
                  type: string
                  format: date-time
                capacity:
                  type: integer
                tags:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Slot updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Slot"
        "400":
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Overlap or capacity conflict
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags:
        - Slots
      summary: Delete slot (ADMIN only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Slot deleted
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Cannot delete due to existing bookings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /bookings:
    post:
      tags:
        - Bookings
      summary: Create a booking (CANDIDATE only)
      parameters:
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [slotId]
              properties:
                slotId:
                  type: string
      responses:
        "201":
          description: Booking created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Booking"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Slot not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Duplicate booking / capacity exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /bookings/my:
    get:
      tags:
        - Bookings
      summary: List candidate's bookings
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [BOOKED, CANCELLED]
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of bookings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Booking"
        "400":
          description: Invalid filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /bookings/{id}/cancel:
    post:
      tags:
        - Bookings
      summary: Cancel a booking (CANDIDATE only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: x-user-id
          in: header
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Booking cancelled successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden / Booking belongs to another user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Capacity / duplicate conflicts
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
